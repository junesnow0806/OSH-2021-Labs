# Lab3

本次实验实现了双人聊天室、多线程聊天室和IO复用聊天室，以下是一些说明：

* 各个聊天室都是一次接收大量的字符，服务端接收消息(可能有多条，一个`\n`标记一条)后使用`strtok`根据`\n`分割消息后再逐条转发给其他客户端。
* 对于一条消息过长的情况，通过每次`recv`返回实际接收的消息长度来判断接收的信息是否完整，如果`recv`返回的实际接收长度len >= 发送缓存长度，说明有可能客户端还有消息因为发送缓存已经满了而没有发送，这时就使用一个while循环不断调用`recv`接收，直到最近一次接收的消息长度小于发送缓存长度。但是实际测试中还是不能接收超过4096字节的消息，会导致程序卡在while循环那里，nc客户端好像也没有继续传输超出4096字节之后的消息，可能是客户端没有接收到服务端类似"我已经接收到了，你可以继续发送剩下的信息"通知。
* 对于多线程聊天室的安全操作问题，服务端每一个线程都一个独立的buffer来接收来自各个客户端的消息，所以接收方面不存在冲突问题，只在向各个客户端转发消息时可能会出现冲突，所以只在send前后使用了互斥锁。